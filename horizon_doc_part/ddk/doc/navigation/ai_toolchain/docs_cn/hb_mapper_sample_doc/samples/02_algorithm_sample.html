

<!DOCTYPE html>
<html class="writer-html5" lang="zh" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>2. 算法模型示例 &mdash; horizon_model_convert_sample_documentation v1.6.6 文档</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/custom-style.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="3. 其他示例" href="03_misc_sample.html" />
    <link rel="prev" title="1. 概述" href="01_general_descriptions.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> horizon_model_convert_sample_documentation
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="在文档中搜索" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="01_general_descriptions.html">1. 概述</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">2. 算法模型示例</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#where-to-find">2.1. where to find</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id2">2.2. 如何准备模型和数据</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#mobilenetv1-v2">2.2.1. MobileNetv1/v2</a></li>
<li class="toctree-l3"><a class="reference internal" href="#googlenet">2.2.2. GoogleNet</a></li>
<li class="toctree-l3"><a class="reference internal" href="#resnet18">2.2.3. ResNet18</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mobilenet-onnx">2.2.4. MobileNet_ONNX</a></li>
<li class="toctree-l3"><a class="reference internal" href="#efficientnet-lite0-1-2-3-4">2.2.5. EfficientNet_Lite0/1/2/3/4</a></li>
<li class="toctree-l3"><a class="reference internal" href="#yolov2">2.2.6. YOLOv2</a></li>
<li class="toctree-l3"><a class="reference internal" href="#yolov3">2.2.7. YOLOv3</a></li>
<li class="toctree-l3"><a class="reference internal" href="#yolov5">2.2.8. YOLOv5</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mobilenet-ssd">2.2.9. MobileNet_SSD</a></li>
<li class="toctree-l3"><a class="reference internal" href="#efficientnet-det">2.2.10. EfficientNet_Det</a></li>
<li class="toctree-l3"><a class="reference internal" href="#centernet">2.2.11. CenterNet</a></li>
<li class="toctree-l3"><a class="reference internal" href="#unet">2.2.12. Unet</a></li>
<li class="toctree-l3"><a class="reference internal" href="#fcos">2.2.13. FCOS</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id3">2.3. 如何使用示例</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id4">2.4. 算法模型示例的使用示例</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id5">2.4.1. 运行Docker</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id6">2.4.2. 检查模型是否能够执行</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id7">2.4.3. 准备校准用的数据集</a></li>
<li class="toctree-l3"><a class="reference internal" href="#build-runtime">2.4.4. build runtime模型</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id8">2.4.5. 精度测试</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="03_misc_sample.html">3. 其他示例</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">horizon_model_convert_sample_documentation</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li><span class="section-number">2. </span>算法模型示例</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/samples/02_algorithm_sample.rst.txt" rel="nofollow"> 查看页面源码</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="id1">
<h1><span class="section-number">2. </span>算法模型示例<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h1>
<div class="section" id="where-to-find">
<h2><span class="section-number">2.1. </span>where to find<a class="headerlink" href="#where-to-find" title="永久链接至标题">¶</a></h2>
<p>算法模型示例位于 <cite>horizon_model_convert_sample</cite> 路径的：
<cite>03_classification/</cite>、<cite>04_detection/</cite> 和 <cite>07_segmentation/</cite> 文件夹中。</p>
</div>
<div class="section" id="id2">
<h2><span class="section-number">2.2. </span>如何准备模型和数据<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h2>
<p>在使用模型转换示例包时，请从地平线提供的模型发布物 <strong>model_zoo/mapper/</strong> 路径下获取我们为您准备好的浮点模型。
对于各原始模型的来源、修改点（如有）以及公共数据集的准备过程，请您参考以下内容。</p>
<div class="admonition note">
<p class="admonition-title">注解</p>
<ul class="simple">
<li><p>以下各模型的帧率（在开发板单线程运行ai_benchmark_j3示例包/script路径下各模型子文件夹的 latency.sh 脚本，不含后处理）计算方法：
<span class="math notranslate nohighlight">\(FPS = 1000 / 推理耗时\)</span>。</p></li>
<li><p>测试开发板：x3sdbx3-samsung2G-3200。</p></li>
<li><p>测试核心数：单核。</p></li>
</ul>
</div>
<div class="section" id="mobilenetv1-v2">
<h3><span class="section-number">2.2.1. </span>MobileNetv1/v2<a class="headerlink" href="#mobilenetv1-v2" title="永久链接至标题">¶</a></h3>
<ol class="arabic simple">
<li><p>模型来源：<a class="reference external" href="https://github.com/shicai/MobileNet-Caffe">https://github.com/shicai/MobileNet-Caffe</a> 。</p></li>
<li><p>md5sum码:</p></li>
</ol>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 53%" />
<col style="width: 47%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>md5sum</p></th>
<th class="head"><p>File</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>3fd6889ec48bda46451d67274144e2a8</p></td>
<td><p>mobilenet.caffemodel</p></td>
</tr>
<tr class="row-odd"><td><p>8922f90f629d428fecf866e798ac7c08</p></td>
<td><p>mobilenet_deploy.prototxt</p></td>
</tr>
<tr class="row-even"><td><p>54aab8425ea068d472e8e4015f22360c</p></td>
<td><p>mobilenet_v2.caffemodel</p></td>
</tr>
<tr class="row-odd"><td><p>13101ee86ab6d217d5fd6ed46f7a4faa</p></td>
<td><p>mobilenet_v2_deploy.prototxt</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<ol class="arabic simple" start="3">
<li><p>可以从ImageNet获得5万张验证图片集。</p></li>
<li><p>校验数据集：可以从ImageNet中抽取少部分图片(100张)作为模型校验数据集。</p></li>
<li><p>模型帧率（不含后处理）：</p></li>
</ol>
<blockquote>
<div><ul class="simple">
<li><p>MobileNetv1：310.66/s。</p></li>
<li><p>MobileNetv2：408.83/s。</p></li>
</ul>
</div></blockquote>
<ol class="arabic simple" start="6">
<li><p>模型精度：</p></li>
</ol>
<blockquote>
<div><ul class="simple">
<li><p>MobileNetv1：0.7016(INT8)。</p></li>
<li><p>MobileNetv2：0.7081(INT8)。</p></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="googlenet">
<h3><span class="section-number">2.2.2. </span>GoogleNet<a class="headerlink" href="#googlenet" title="永久链接至标题">¶</a></h3>
<ol class="arabic simple">
<li><p>模型来源：<a class="reference external" href="https://github.com/HorizonRobotics-Platform/ModelZoo/tree/master/GoogleNet">https://github.com/HorizonRobotics-Platform/ModelZoo/tree/master/GoogleNet</a>。</p></li>
<li><p>md5sum码:</p></li>
</ol>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 68%" />
<col style="width: 32%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>md5sum</p></th>
<th class="head"><p>File</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>f107ae6806ea1016afbc718210b7a617</p></td>
<td><p>googlenet.onnx</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<ol class="arabic simple" start="3">
<li><p>可以从ImageNet获得5万张验证图片集。</p></li>
<li><p>校验数据集：可以从ImageNet中抽取少部分图片(100张)作为模型校验数据集。</p></li>
<li><p>模型帧率（不含后处理）：113.87/s。</p></li>
<li><p>模型精度：0.6997(INT8)。</p></li>
</ol>
</div>
<div class="section" id="resnet18">
<h3><span class="section-number">2.2.3. </span>ResNet18<a class="headerlink" href="#resnet18" title="永久链接至标题">¶</a></h3>
<ol class="arabic simple">
<li><p>模型来源：<a class="reference external" href="https://github.com/HolmesShuan/ResNet-18-Caffemodel-on-ImageNet">https://github.com/HolmesShuan/ResNet-18-Caffemodel-on-ImageNet</a>。</p></li>
<li><p>md5sum码:</p></li>
</ol>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 62%" />
<col style="width: 38%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>md5sum</p></th>
<th class="head"><p>File</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0904d601fc930d4f0c62a2a95b3c3b93</p></td>
<td><p>resnet18.caffemodel</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<ol class="arabic simple" start="3">
<li><p>可以从ImageNet获得5万张验证图片集。</p></li>
<li><p>校验数据集：可以从ImageNet中抽取少部分图片(100张)作为模型校验数据集。</p></li>
<li><p>模型帧率（不含后处理）：120.28/s。</p></li>
<li><p>模型精度：0.6836(INT8)。</p></li>
</ol>
</div>
<div class="section" id="mobilenet-onnx">
<h3><span class="section-number">2.2.4. </span>MobileNet_ONNX<a class="headerlink" href="#mobilenet-onnx" title="永久链接至标题">¶</a></h3>
<ol class="arabic simple">
<li><p>模型来源：<a class="reference external" href="https://github.com/HorizonRobotics-Platform/ModelZoo/tree/master/MobilentV2Onnx">https://github.com/HorizonRobotics-Platform/ModelZoo/tree/master/MobilentV2Onnx</a>。</p></li>
<li><p>md5sum码:</p></li>
</ol>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 65%" />
<col style="width: 35%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>md5sum</p></th>
<th class="head"><p>File</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>bfa26b2b247bb060a35b67062a3ebbd1</p></td>
<td><p>mobilenetv2.onnx</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<ol class="arabic simple" start="3">
<li><p>可以从ImageNet获得5万张验证图片集。</p></li>
<li><p>校验数据集：可以从ImageNet中抽取少部分图片(100张)作为模型校验数据集。</p></li>
</ol>
</div>
<div class="section" id="efficientnet-lite0-1-2-3-4">
<h3><span class="section-number">2.2.5. </span>EfficientNet_Lite0/1/2/3/4<a class="headerlink" href="#efficientnet-lite0-1-2-3-4" title="永久链接至标题">¶</a></h3>
<ol class="arabic simple">
<li><p>从模型来源：<a class="reference external" href="https://github.com/tensorflow/tpu/tree/master/models/official/efficientnet/lite">https://github.com/tensorflow/tpu/tree/master/models/official/efficientnet/lite</a> 获取tar包。</p></li>
<li><p>md5sum码:</p></li>
</ol>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 56%" />
<col style="width: 44%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>md5sum</p></th>
<th class="head"><p>File</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>703c66bc3d3463bd15c00c5e2ec535eb</p></td>
<td><p>efficientnet-lite0.tar.gz</p></td>
</tr>
<tr class="row-odd"><td><p>6914aa625b58a2cb786f92597af8d63a</p></td>
<td><p>efficientnet-lite1.tar.gz</p></td>
</tr>
<tr class="row-even"><td><p>da60c250593ee1c5eff9d3efb3c5eb92</p></td>
<td><p>efficientnet-lite2.tar.gz</p></td>
</tr>
<tr class="row-odd"><td><p>c8bcffb764c77a2fee359d8b96ca1977</p></td>
<td><p>efficientnet-lite3.tar.gz</p></td>
</tr>
<tr class="row-even"><td><p>9042a6c9166875a4a5fdc82f56bcb64a</p></td>
<td><p>efficientnet-lite4.tar.gz</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="admonition attention">
<p class="admonition-title">注意</p>
<p>为了快速运行示例，避免使用第三方工具带来的风险，强烈推荐您直接使用地平线模型发布物 <strong>model_zoo/mapper/</strong> 路径下准备好的ONNX浮点模型。
如果您有兴趣复现tflite2onnx的模型转换过程，也可以尝试使用以下三方工具。但地平线无法保证第三方工具的质量和转换成功率。</p>
</div>
<ol class="arabic simple" start="3">
<li><p>下载后可从tar包中得到.tflite文件，然后可通过tflite2onnx工具 (<a class="reference external" href="https://pypi.org/project/tflite2onnx/">https://pypi.org/project/tflite2onnx/</a>) 将tflite转换为ONNX模型。
不同版本的tflite2onnx转换出来的layout会不一样，若转换出来的ONNX模型的输入layout是NCHW排布，
则build时 <code class="docutils literal notranslate"><span class="pre">input_type_train</span></code> ，EfficientNet_Lite0应该选择 <code class="docutils literal notranslate"><span class="pre">NCHW</span></code>，
EfficientNet_Lite1应该选择 <code class="docutils literal notranslate"><span class="pre">NCHW</span></code>，
EfficientNet_Lite2应该选择 <code class="docutils literal notranslate"><span class="pre">NCHW</span></code>，
EfficientNet_Lite3应该选择 <code class="docutils literal notranslate"><span class="pre">NCHW</span></code>，
EfficientNet_Lite4应该选择 <code class="docutils literal notranslate"><span class="pre">NCHW</span></code>。</p></li>
<li><p>可以从ImageNet data获得5万张验证图片集。</p></li>
<li><p>校验数据集：可以从ImageNet中抽取少部分图片(100张)作为模型校验数据集。</p></li>
<li><p>模型帧率（不含后处理）：</p></li>
</ol>
<blockquote>
<div><ul class="simple">
<li><p>EfficientNet_Lite0：439.75/s。</p></li>
<li><p>EfficientNet_Lite1：314.56/s。</p></li>
<li><p>EfficientNet_Lite2：175.10/s。</p></li>
<li><p>EfficientNet_Lite3：117.36/s。</p></li>
<li><p>EfficientNet_Lite4：68.39/s。</p></li>
</ul>
</div></blockquote>
<ol class="arabic simple" start="7">
<li><p>模型精度：</p></li>
</ol>
<blockquote>
<div><ul class="simple">
<li><p>EfficientNet_Lite0：0.7469(INT8)。</p></li>
<li><p>EfficientNet_Lite1：0.7625(INT8)。</p></li>
<li><p>EfficientNet_Lite2：0.7716(INT8)。</p></li>
<li><p>EfficientNet_Lite3：0.7905(INT8)。</p></li>
<li><p>EfficientNet_Lite4：0.8058(INT8)。</p></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="yolov2">
<h3><span class="section-number">2.2.6. </span>YOLOv2<a class="headerlink" href="#yolov2" title="永久链接至标题">¶</a></h3>
<div class="admonition attention">
<p class="admonition-title">注意</p>
<p>为了快速运行示例，避免使用第三方工具带来的风险，强烈推荐您直接使用地平线模型发布物 <strong>model_zoo/mapper/</strong> 路径下准备好的Caffe浮点模型。
如果您有兴趣复现darknet2caffe的模型转换过程，也可以尝试使用以下三方工具。但地平线无法保证三方工具的质量和转换成功率。</p>
</div>
<ol class="arabic simple">
<li><p>YOLOv2模型需要首先从yolo官网(<a class="reference external" href="https://pjreddie.com/darknet/yolo/">https://pjreddie.com/darknet/yolo/</a>)下载YOLOv2 608x608的.cfg和.weight文件
并使用darknet2caffe (<a class="reference external" href="https://github.com/xingyanan/darknet2caffe">https://github.com/xingyanan/darknet2caffe</a>) 转换工具将其转换为caffe model。
(该转换工具是一个简化版本，使用时，需要修改该工具生成的.prototxt文件，
将其中的 <code class="docutils literal notranslate"><span class="pre">'Reshape'</span></code> 层修改成 <code class="docutils literal notranslate"><span class="pre">'Passthrough'</span></code> 层，Passthrough 层具体修改后的参数请见提供的yolov2.prototxt例子，
并在输出节点增加一个NCHW2NHWC的Permute操作。)</p></li>
<li><p>COCO验证集，用于计算模型精度，可以从COCO官网下载：<a class="reference external" href="http://cocodataset.org/">http://cocodataset.org/</a>。</p></li>
<li><p>校准数据集：可以从COCO验证集中抽取50张图片作为校准数据。</p></li>
<li><p>模型帧率（不含后处理）：6.49/s。</p></li>
<li><p>模型精度：</p></li>
</ol>
<blockquote>
<div><ul class="simple">
<li><p>[IoU=0.50:0.95]:0.271(INT8)。</p></li>
<li><p>[IoU=0.50]:0.494(INT8)。</p></li>
<li><p>[IoU=0.75]:0.272(INT8)。</p></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="yolov3">
<h3><span class="section-number">2.2.7. </span>YOLOv3<a class="headerlink" href="#yolov3" title="永久链接至标题">¶</a></h3>
<ol class="arabic simple">
<li><p>YOLOv3模型获取：</p></li>
</ol>
<blockquote>
<div><ul>
<li><p>URL: <a class="reference external" href="https://github.com/ChenYingpeng/caffe-yolov3/">https://github.com/ChenYingpeng/caffe-yolov3/</a>  caffemodel 可以在该github的README.md提供的百度云下载路径中下载，
并在输出节点增加一个NCHW2NHWC的Permute操作。</p></li>
<li><p>md5sum码:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 64%" />
<col style="width: 36%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>md5sum</p></th>
<th class="head"><p>File</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>97409acf0c9d5b2a915f5e4ed3024544</p></td>
<td><p>yolov3.prototxt</p></td>
</tr>
<tr class="row-odd"><td><p>9a0f09c850656913ec27a6da06d9f9cc</p></td>
<td><p>yolov3.caffemodel</p></td>
</tr>
</tbody>
</table>
</li>
</ul>
</div></blockquote>
<ol class="arabic simple" start="2">
<li><p>COCO验证集，用于计算模型精度，可以从COCO官网下载：<a class="reference external" href="http://cocodataset.org/">http://cocodataset.org/</a>。</p></li>
<li><p>校准数据集：可以从COCO验证集中抽取50张图片作为校准数据。</p></li>
<li><p>模型帧率（不含后处理）：6.00/s。</p></li>
<li><p>模型精度：</p></li>
</ol>
<blockquote>
<div><ul class="simple">
<li><p>[IoU=0.50:0.95]：0.336(INT8)。</p></li>
<li><p>[IoU=0.50]：0.575(INT8)。</p></li>
<li><p>[IoU=0.75]：0.358(INT8)。</p></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="yolov5">
<h3><span class="section-number">2.2.8. </span>YOLOv5<a class="headerlink" href="#yolov5" title="永久链接至标题">¶</a></h3>
<ol class="arabic simple">
<li><p>YOLOv5模型：</p></li>
</ol>
<blockquote>
<div><ul>
<li><p>可以从URL: <a class="reference external" href="https://github.com/ultralytics/yolov5/releases/tag/v2.0">https://github.com/ultralytics/yolov5/releases/tag/v2.0</a> 中下载相应的pt文件。</p>
<div class="admonition important">
<p class="admonition-title">重要</p>
<p>在clone代码时，请确认您使用的Tags是 <span class="red">v2.0</span>，否则将导致转换失败。</p>
</div>
</li>
<li><p>md5sum码:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 74%" />
<col style="width: 26%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>md5sum</p></th>
<th class="head"><p>File</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>2e296b5e31bf1e1b6b8ea4bf36153ea5</p></td>
<td><p>yolov5l.pt</p></td>
</tr>
<tr class="row-odd"><td><p>16150e35f707a2f07e7528b89c032308</p></td>
<td><p>yolov5m.pt</p></td>
</tr>
<tr class="row-even"><td><p>42c681cf466c549ff5ecfe86bcc491a0</p></td>
<td><p>yolov5s.pt</p></td>
</tr>
<tr class="row-odd"><td><p>069a6baa2a741dec8a2d44a9083b6d6e</p></td>
<td><p>yolov5x.pt</p></td>
</tr>
</tbody>
</table>
</li>
<li><p>下载完成后通过脚本 <a class="reference external" href="https://github.com/ultralytics/yolov5/blob/v2.0/models/export.py">https://github.com/ultralytics/yolov5/blob/v2.0/models/export.py</a> 进行pt文件到ONNX文件的转换。</p>
<div class="admonition attention">
<p class="admonition-title">注意</p>
<p>在使用export.py脚本时，请注意：</p>
<ol class="arabic simple">
<li><p>由于地平线AI工具链支持的ONNX opset版本为 <span class="red">10</span> 和 <span class="red">11</span>，
请将 <code class="docutils literal notranslate"><span class="pre">torch.onnx.export</span></code> 的 <code class="docutils literal notranslate"><span class="pre">opset_version</span></code> 参数根据您要使用的版本进行修改。</p></li>
<li><p>将 <code class="docutils literal notranslate"><span class="pre">torch.onnx.export</span></code> 部分的默认输入名称参数由 <code class="docutils literal notranslate"><span class="pre">'images'</span></code>
改为 <code class="docutils literal notranslate"><span class="pre">'data'</span></code>，与模型转换示例包的YOLOv5示例脚本保持一致。</p></li>
<li><p>将 <code class="docutils literal notranslate"><span class="pre">parser.add_argument</span></code> 部分中默认的数据输入尺寸640x640改为模型转换示例包YOLOv5示例中的672x672。</p></li>
</ol>
<p>此处为了快速运行模型转换示例包的脚本对export.py脚本中的配置参数做了如上修改；
在研发和生产环境中，您也可以根据实际业务要求对示例脚本客制化。</p>
</div>
</li>
<li><p>YOLOv5模型，我们修改了几个输出节点处。由于目前的浮点转换工具链暂时不支持5维的Reshape，所以我们在prototxt中进行了删除，
并将其移至后处理中执行。下图以一个输出节点为例进行说明，可以看到左图中的红框部分均被移除，同时在右图中我们还添加了一个
transpose算子，使该节点将以NHWC进行输出。这是因为在地平线芯片中，BPU硬件本身以NHWC的layout运行，
这样修改后可以让BPU直接输出结果，而不在量化模型中引入额外的transpose。详见下图：</p>
<img alt="../_images/yolov5.png" class="align-center" src="../_images/yolov5.png" />
</li>
</ul>
</div></blockquote>
<ol class="arabic simple" start="2">
<li><p>COCO验证集，用于计算模型精度，可以从COCO官网下载：<a class="reference external" href="http://cocodataset.org/">http://cocodataset.org/</a>。</p></li>
<li><p>校准数据集：可以从COCO验证集中抽取50张图片作为校准数据。</p></li>
<li><p>模型帧率（不含后处理）：14.63/s。</p></li>
<li><p>模型精度：</p></li>
</ol>
<blockquote>
<div><ul class="simple">
<li><p>[IoU=0.50:0.95]：0.341(INT8)。</p></li>
<li><p>[IoU=0.50]：0.533(INT8)。</p></li>
<li><p>[IoU=0.75]：0.367(INT8)。</p></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="mobilenet-ssd">
<h3><span class="section-number">2.2.9. </span>MobileNet_SSD<a class="headerlink" href="#mobilenet-ssd" title="永久链接至标题">¶</a></h3>
<ol class="arabic simple">
<li><p>MobilenetSSD模型:</p></li>
</ol>
<blockquote>
<div><ul>
<li><p>可以从URL: <a class="reference external" href="https://github.com/chuanqi305/MobileNet-SSD">https://github.com/chuanqi305/MobileNet-SSD</a> 获得Caffe模型。</p></li>
<li><p>md5sum码:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 51%" />
<col style="width: 49%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>md5sum</p></th>
<th class="head"><p>File</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>bbcb3b6a0afe1ec89e1288096b5b8c66</p></td>
<td><p>mobilenet_iter_73000.caffemodel</p></td>
</tr>
</tbody>
</table>
</li>
</ul>
</div></blockquote>
<ol class="arabic simple" start="2">
<li><p>VOC验证集，用于计算模型精度，可以从VOC官网下载： <a class="reference external" href="http://host.robots.ox.ac.uk/pascal/VOC/voc2012/">http://host.robots.ox.ac.uk/pascal/VOC/voc2012/</a>。</p></li>
<li><p>校准数据集：可以从VOC验证集中抽取50张图片作为校准数据。</p></li>
<li><p>模型帧率（不含后处理）：142.51/s。</p></li>
<li><p>模型精度：0.9734(INT8)。</p></li>
</ol>
</div>
<div class="section" id="efficientnet-det">
<h3><span class="section-number">2.2.10. </span>EfficientNet_Det<a class="headerlink" href="#efficientnet-det" title="永久链接至标题">¶</a></h3>
<ol class="arabic simple">
<li><p>模型来源：<a class="reference external" href="https://github.com/HorizonRobotics-Platform/ModelZoo/tree/master/EfficientDet">https://github.com/HorizonRobotics-Platform/ModelZoo/tree/master/EfficientDet</a>。</p></li>
<li><p>md5sum码:</p></li>
</ol>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 59%" />
<col style="width: 41%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>md5sum</p></th>
<th class="head"><p>File</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>ec4129c4b300cd04f1e8f71e0fe54ca5</p></td>
<td><p>efficientdet_nhwc.onnx</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<ol class="arabic simple" start="3">
<li><p>COCO验证集，用于计算模型精度，可以从COCO官网下载：<a class="reference external" href="http://cocodataset.org/">http://cocodataset.org/</a>。</p></li>
<li><p>校验数据集：可以从COCO验证集中抽取50张图片作为校准数据。</p></li>
<li><p>模型帧率（不含后处理）：29.46/s。</p></li>
<li><p>模型精度：</p></li>
</ol>
<blockquote>
<div><ul class="simple">
<li><p>[IoU=0.50:0.95]：0.313(INT8)。</p></li>
<li><p>[IoU=0.50]：0.485(INT8)。</p></li>
<li><p>[IoU=0.75]：0.325(INT8)。</p></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="centernet">
<h3><span class="section-number">2.2.11. </span>CenterNet<a class="headerlink" href="#centernet" title="永久链接至标题">¶</a></h3>
<ol class="arabic simple">
<li><p>模型来源：<a class="reference external" href="https://github.com/HorizonRobotics-Platform/ModelZoo/tree/master/Centernet">https://github.com/HorizonRobotics-Platform/ModelZoo/tree/master/Centernet</a>。</p></li>
<li><p>md5sum码:</p></li>
</ol>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 58%" />
<col style="width: 42%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>md5sum</p></th>
<th class="head"><p>File</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>fa1e884882a54fa3520d1e51477b4c1a</p></td>
<td><p>centernet_resnet50.onnx</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<ol class="arabic simple" start="3">
<li><p>COCO验证集，用于计算模型精度，可以从COCO官网下载：<a class="reference external" href="http://cocodataset.org/">http://cocodataset.org/</a>。</p></li>
<li><p>校验数据集：可以从COCO验证集中抽取50张图片作为校准数据。</p></li>
<li><p>模型帧率（不含后处理）：8.43/s。</p></li>
<li><p>模型精度：</p></li>
</ol>
<blockquote>
<div><ul class="simple">
<li><p>[IoU=0.50:0.95]：0.313(INT8)。</p></li>
<li><p>[IoU=0.50]：0.500(INT8)。</p></li>
<li><p>[IoU=0.75]：0.324(INT8)。</p></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="unet">
<h3><span class="section-number">2.2.12. </span>Unet<a class="headerlink" href="#unet" title="永久链接至标题">¶</a></h3>
<ol class="arabic simple">
<li><p>模型来源：<a class="reference external" href="https://github.com/HorizonRobotics-Platform/ModelZoo/tree/master/MobilenetUnet">https://github.com/HorizonRobotics-Platform/ModelZoo/tree/master/MobilenetUnet</a>。</p></li>
<li><p>md5sum码：</p></li>
</ol>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 61%" />
<col style="width: 39%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>md5sum</p></th>
<th class="head"><p>File</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>21c6c645ebca92befbebc8c39d385c1e</p></td>
<td><p>tf_unet_trained.onnx</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<ol class="arabic simple" start="3">
<li><p>Cityscapes验证集，用于计算模型精度，可以从Cityscapes官网下载：<a class="reference external" href="https://www.cityscapes-dataset.com/">https://www.cityscapes-dataset.com/</a>。</p></li>
<li><p>校准数据集：可以从Cityscapes验证集中抽取50张图片作为校准数据。</p></li>
<li><p>模型帧率（不含后处理）：22.85/s。</p></li>
<li><p>模型精度：</p></li>
</ol>
<blockquote>
<div><ul class="simple">
<li><p>accuracy: 0.9364(INT8)。</p></li>
<li><p>mIoU: 0.638307(INT8)。</p></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="fcos">
<h3><span class="section-number">2.2.13. </span>FCOS<a class="headerlink" href="#fcos" title="永久链接至标题">¶</a></h3>
<ol class="arabic simple">
<li><p>模型来源：可以从地平线模型开源repo获, repo 地址暂时待定。</p></li>
<li><p>md5sum码：</p></li>
</ol>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 76%" />
<col style="width: 24%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>md5sum</p></th>
<th class="head"><p>File</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>f9d0c6d71f2e9c48518959e9d890288f</p></td>
<td><p>fcos.onnx</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<ol class="arabic simple" start="3">
<li><p>COCO验证集，用于计算模型精度，可以从COCO官网下载：<a class="reference external" href="http://cocodataset.org/">http://cocodataset.org/</a>。</p></li>
<li><p>校准数据集：可以从COCO验证集中抽取50张图片作为校准数据。</p></li>
<li><p>模型帧率（不含后处理）：70.22/s。</p></li>
<li><p>模型精度：</p></li>
</ol>
<blockquote>
<div><ul class="simple">
<li><p>[IoU=0.50:0.95]：0.333(INT8)。</p></li>
<li><p>[IoU=0.50]：0.503(INT8)。</p></li>
<li><p>[IoU=0.75]：0.355(INT8)。</p></li>
</ul>
</div></blockquote>
</div>
</div>
<div class="section" id="id3">
<h2><span class="section-number">2.3. </span>如何使用示例<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h2>
<p>为了让开发者快速体验示例包、简化安装配置工作，此处为您介绍在Docker容器中快速运行示例的必要步骤：</p>
<ol class="arabic simple">
<li><p>根据《Horizon AI Toolchain User Guide》文档中的
<a class="reference external" href="../../horizon_ai_toolchain_user_guide/chapter_2_prerequisites.html#docker">使用Docker环境</a>
一节内容完成Docker环境的安装和配置。</p></li>
<li><p>获取以下发布物：</p></li>
</ol>
<blockquote>
<div><ul class="simple">
<li><p>示例包Docker镜像：<cite>openexplorer/ai_toolchain_centos_7:{version}</cite>；</p></li>
<li><p>示例包文件夹：<cite>horizon_model_convert_sample/</cite>；</p></li>
<li><p>模型发布物文件夹：<cite>model_zoo/</cite>；</p></li>
<li><p>下载COCO, ImageNet, CIFAR-10, VOCdevkit, WIDER FACE或Cityscapes等数据集（或联系地平线工程师获取），
然后创建 <cite>/data</cite> 文件夹；</p></li>
<li><p>将以上数据集解压到 <cite>/data/horizon_x3/data</cite> 中（或者将 <cite>01_common/data</cite> 的软链接更改指向下载的data数据地址）。</p></li>
</ul>
</div></blockquote>
<ol class="arabic simple" start="3">
<li><p>将以上发布物放置在同级目录下。</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">注解</p>
<p><cite>01_common/data</cite> 默认是一个指向 <cite>/data/horizon_x3/data</cite> 的软链接。</p>
</div>
</div>
<div class="section" id="id4">
<h2><span class="section-number">2.4. </span>算法模型示例的使用示例<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h2>
<p>本小节以YOLOv2模型为例，使用算法模型示例包中 <cite>04_detection/ 01_yolov2/mapper/</cite> 路径下脚本
分步骤演示浮点模型到定点模型转换过程中的模型检查、校准数据集准备、runtime模型构建及模型精度测试几个关键步骤。</p>
<div class="admonition note">
<p class="admonition-title">注解</p>
<p>更多嵌入式开发示例包的使用信息请参见本嵌入式示例包文档。</p>
</div>
<div class="section" id="id5">
<h3><span class="section-number">2.4.1. </span>运行Docker<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">注解</p>
<p>此处的版本号仅为示例，请将其替换为您实际获取到的镜像版本号。</p>
</div>
<p>运行Docker容器</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker run -it <span class="se">\</span>
<span class="hll">  -v <span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>/horizon_model_convert_sample:/release <span class="se">\</span>
</span><span class="hll">  -v <span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>/data:/data/horizon_x3/data  <span class="se">\</span>
</span><span class="hll">  -v <span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>/model_zoo:/model_zoo <span class="se">\</span>
</span>  openexplorer/ai_toolchain_centos_7:v1.6.6 /bin/bash
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注解</p>
<ul class="simple">
<li><p>`pwd`/horizon_model_convert_sample 为模型转换示例包目录。</p></li>
<li><p>`pwd`/data 为数据集文件目录，如果 <cite>data</cite> 目录不存在会导致加载问题，需要创建好后再运行命令。
如果您没有这部分数据，请联系地平线工程师获取。</p></li>
<li><p>`pwd`/model_zoo 中包含了模型转换和嵌入式开发示例包运行所需的浮点和定点模型及相关文件。</p></li>
</ul>
</div>
</div>
<div class="section" id="id6">
<h3><span class="section-number">2.4.2. </span>检查模型是否能够执行<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h3>
<ol class="arabic simple">
<li><p>如下所示，运行脚本：</p></li>
</ol>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># 1. 进入示例脚本放置的文件夹</span>
<span class="nb">cd</span> 04_detection/01_yolov2/mapper
<span class="c1"># 2. 执行模型检查</span>
sh 01_check.sh
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="2">
<li><p>模型检查输出：</p></li>
</ol>
<blockquote>
<div><p>上述脚本使用 <code class="docutils literal notranslate"><span class="pre">hb_mapper</span> <span class="pre">checker</span></code> 工具检查模型是否被地平线芯片支持。同时也会输出一个OP列表，表示每个OP会CPU还是BPU上执行。
如下所示：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">==============================================</span>
Node         ON   Subgraph  Type
----------------------------------------------
layer1_conv      BPU  id<span class="o">(</span><span class="m">0</span><span class="o">)</span>     HzSQuantizedConv
layer1_act       BPU  id<span class="o">(</span><span class="m">0</span><span class="o">)</span>     HzLeakyRelu
layer2_maxpool   BPU  id<span class="o">(</span><span class="m">0</span><span class="o">)</span>     HzQuantizedMaxPool
layer3_conv      BPU  id<span class="o">(</span><span class="m">0</span><span class="o">)</span>     HzSQuantizedConv
layer3_act       BPU  id<span class="o">(</span><span class="m">0</span><span class="o">)</span>     HzLeakyRelu
layer4_maxpool   BPU  id<span class="o">(</span><span class="m">0</span><span class="o">)</span>     HzQuantizedMaxPool
layer5_conv      BPU  id<span class="o">(</span><span class="m">0</span><span class="o">)</span>     HzSQuantizedConv
layer5_act       BPU  id<span class="o">(</span><span class="m">0</span><span class="o">)</span>     HzLeakyRelu
layer6_conv      BPU  id<span class="o">(</span><span class="m">0</span><span class="o">)</span>     HzSQuantizedConv
layer6_act       BPU  id<span class="o">(</span><span class="m">0</span><span class="o">)</span>     HzLeakyRelu
layer7_conv      BPU  id<span class="o">(</span><span class="m">0</span><span class="o">)</span>     HzSQuantizedConv
layer7_act       BPU  id<span class="o">(</span><span class="m">0</span><span class="o">)</span>     HzLeakyRelu
layer8_maxpool   BPU  id<span class="o">(</span><span class="m">0</span><span class="o">)</span>     HzQuantizedMaxPool
layer9_conv      BPU  id<span class="o">(</span><span class="m">0</span><span class="o">)</span>     HzSQuantizedConv
layer9_act       BPU  id<span class="o">(</span><span class="m">0</span><span class="o">)</span>     HzLeakyRelu
layer10_conv     BPU  id<span class="o">(</span><span class="m">0</span><span class="o">)</span>     HzSQuantizedConv
layer10_act      BPU  id<span class="o">(</span><span class="m">0</span><span class="o">)</span>     HzLeakyRelu
layer11_conv     BPU  id<span class="o">(</span><span class="m">0</span><span class="o">)</span>     HzSQuantizedConv
layer11_act      BPU  id<span class="o">(</span><span class="m">0</span><span class="o">)</span>     HzLeakyRelu
layer12_maxpool  BPU  id<span class="o">(</span><span class="m">0</span><span class="o">)</span>     HzQuantizedMaxPool
layer13_conv     BPU  id<span class="o">(</span><span class="m">0</span><span class="o">)</span>     HzSQuantizedConv
layer13_act      BPU  id<span class="o">(</span><span class="m">0</span><span class="o">)</span>     HzLeakyRelu
layer14_conv     BPU  id<span class="o">(</span><span class="m">0</span><span class="o">)</span>     HzSQuantizedConv
layer14_act      BPU  id<span class="o">(</span><span class="m">0</span><span class="o">)</span>     HzLeakyRelu
layer15_conv     BPU  id<span class="o">(</span><span class="m">0</span><span class="o">)</span>     HzSQuantizedConv
layer15_act      BPU  id<span class="o">(</span><span class="m">0</span><span class="o">)</span>     HzLeakyRelu
layer16_conv     BPU  id<span class="o">(</span><span class="m">0</span><span class="o">)</span>     HzSQuantizedConv
layer16_act      BPU  id<span class="o">(</span><span class="m">0</span><span class="o">)</span>     HzLeakyRelu
layer17_conv     BPU  id<span class="o">(</span><span class="m">0</span><span class="o">)</span>     HzSQuantizedConv
layer17_act      BPU  id<span class="o">(</span><span class="m">0</span><span class="o">)</span>     HzLeakyRelu
layer18_maxpool  BPU  id<span class="o">(</span><span class="m">0</span><span class="o">)</span>     HzQuantizedMaxPool
layer19_conv     BPU  id<span class="o">(</span><span class="m">0</span><span class="o">)</span>     HzSQuantizedConv
layer19_act      BPU  id<span class="o">(</span><span class="m">0</span><span class="o">)</span>     HzLeakyRelu
layer20_conv     BPU  id<span class="o">(</span><span class="m">0</span><span class="o">)</span>     HzSQuantizedConv
layer20_act      BPU  id<span class="o">(</span><span class="m">0</span><span class="o">)</span>     HzLeakyRelu
layer21_conv     BPU  id<span class="o">(</span><span class="m">0</span><span class="o">)</span>     HzSQuantizedConv
layer21_act      BPU  id<span class="o">(</span><span class="m">0</span><span class="o">)</span>     HzLeakyRelu
layer22_conv     BPU  id<span class="o">(</span><span class="m">0</span><span class="o">)</span>     HzSQuantizedConv
layer22_act      BPU  id<span class="o">(</span><span class="m">0</span><span class="o">)</span>     HzLeakyRelu
layer23_conv     BPU  id<span class="o">(</span><span class="m">0</span><span class="o">)</span>     HzSQuantizedConv
layer23_act      BPU  id<span class="o">(</span><span class="m">0</span><span class="o">)</span>     HzLeakyRelu
layer24_conv     BPU  id<span class="o">(</span><span class="m">0</span><span class="o">)</span>     HzSQuantizedConv
layer24_act      BPU  id<span class="o">(</span><span class="m">0</span><span class="o">)</span>     HzLeakyRelu
layer25_conv     BPU  id<span class="o">(</span><span class="m">0</span><span class="o">)</span>     HzSQuantizedConv
layer25_act      BPU  id<span class="o">(</span><span class="m">0</span><span class="o">)</span>     HzLeakyRelu
layer27_conv     BPU  id<span class="o">(</span><span class="m">0</span><span class="o">)</span>     HzSQuantizedConv
layer27_act      BPU  id<span class="o">(</span><span class="m">0</span><span class="o">)</span>     HzLeakyRelu
layer28_reorg    BPU  id<span class="o">(</span><span class="m">0</span><span class="o">)</span>     HzSpaceToDepth
layer29_concat   BPU  id<span class="o">(</span><span class="m">0</span><span class="o">)</span>     Concat
layer30_conv     BPU  id<span class="o">(</span><span class="m">0</span><span class="o">)</span>     HzSQuantizedConv
layer30_act      BPU  id<span class="o">(</span><span class="m">0</span><span class="o">)</span>     HzLeakyRelu
layer31_conv     BPU  id<span class="o">(</span><span class="m">0</span><span class="o">)</span>     HzSQuantizedConv
----------------------End-----------------------
</pre></div>
</div>
<div class="admonition important">
<p class="admonition-title">重要</p>
<p>目前模型转换工具支持的最大输出数目为32。若原始模型的输出数目大于32个则会报错。</p>
</div>
</div></blockquote>
</div>
<div class="section" id="id7">
<h3><span class="section-number">2.4.3. </span>准备校准用的数据集<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h3>
<ol class="arabic simple" start="3">
<li><p>在同一路径下继续执行 <code class="docutils literal notranslate"><span class="pre">02_preprocess.sh</span></code> 脚本，如下所示：</p></li>
</ol>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># 将 01_common/data/coco/calibration_data中的图片</span>
<span class="c1"># 转换到: ./calibration_data_bgr</span>
<span class="n">sh</span> <span class="mi">02</span><span class="n">_preprocess</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注解</p>
<ol class="arabic simple">
<li><p>我们从COCO数据集抽取了50张图作为校准数据集，在校准前，我们对数据进行了预处理： <strong>pad-resize/转为bgr</strong>。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">hb_mapper</span></code> 工具会从转换得到二进制数据中读取数据，预处理过的二进制数据文件格式为：c-order的矩阵存储。
每个矩阵值的数据类型为int8。</p></li>
</ol>
</div>
</div></blockquote>
</div>
<div class="section" id="build-runtime">
<h3><span class="section-number">2.4.4. </span>build runtime模型<a class="headerlink" href="#build-runtime" title="永久链接至标题">¶</a></h3>
<ol class="arabic simple" start="4">
<li><p>在同一路径下继续执行 <code class="docutils literal notranslate"><span class="pre">03_build.sh</span></code> 脚本，如下所示：</p></li>
</ol>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sh</span> <span class="mi">03</span><span class="n">_build</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注解</p>
<p>上述脚本使用 <code class="docutils literal notranslate"><span class="pre">hb_mapper</span></code> 工具转换模型，最需要关注的是转换的配置文件，
请参考文档包 <a class="reference external" href="../../horizon_ai_toolchain_user_guide/chapter_3_model_conversion.html#hb-mapper-makertbin">Horizon AI Toolchain User Guide</a> 文档中《使用 hb_mapper makertbin 工具转换模型》内容。</p>
</div>
<p>上述脚本的输出如下所示：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&gt;&gt; ls model_output <span class="p">|</span> cat
full_yolov2_subgraph_0.html
full_yolov2_subgraph_0.json
<span class="hll">yolov2_608x608_nv12.bin
</span>yolov2_608x608_nv12_optimized_float_model.onnx
yolov2_608x608_nv12_original_float_model.onnx
yolov2_608x608_nv12_quantized_model.onnx
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注解</p>
<p>您暂时只需要关心 <strong>yolov2_608x608_nv12.bin</strong> 文件，其他文件会在工具的介绍中进行说明。</p>
</div>
</div></blockquote>
</div>
<div class="section" id="id8">
<h3><span class="section-number">2.4.5. </span>精度测试<a class="headerlink" href="#id8" title="永久链接至标题">¶</a></h3>
<ol class="arabic simple">
<li><p>继续执行 <code class="docutils literal notranslate"><span class="pre">05_evaluate.sh</span></code> 脚本进行精度评测，如下所示：</p></li>
</ol>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">PARALLEL_PROCESS_NUM</span><span class="o">=</span><span class="si">${</span><span class="nv">parallel_process_num</span><span class="si">}</span>
sh 05_evaluate.sh
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注解</p>
<ol class="arabic simple">
<li><p>因为精度评测时，需要对图片进行 <strong>前处理</strong>，对模型数据进行 <strong>后处理</strong>，而且需要计算map，所以我们提供了一个示例Python脚本。
具体请参考 <code class="docutils literal notranslate"><span class="pre">sh</span> <span class="pre">05_evaluate.sh</span></code>。</p></li>
<li><p>为了加快评测速度，可以适当调整并发进程数，但需要注意内存的占用情况。</p></li>
</ol>
</div>
</div></blockquote>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="03_misc_sample.html" class="btn btn-neutral float-right" title="3. 其他示例" accesskey="n" rel="next">下一页 <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="01_general_descriptions.html" class="btn btn-neutral float-left" title="1. 概述" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> 上一页</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; 版权所有 2021, horizon.

    </p>
  </div>
    
    
    
    利用 <a href="https://www.sphinx-doc.org/">Sphinx</a> 构建，使用了 
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">主题</a>
    
    由 <a href="https://readthedocs.org">Read the Docs</a>开发. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>